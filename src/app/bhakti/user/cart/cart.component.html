<div class="cart-container">
  <h2>ğŸ›’ Your Cart</h2>

  <!-- Cart Items -->
  <table *ngIf="cartItems.length > 0; else emptyCart">
    <thead>
      <tr>
        <th>Item</th>
        <th>Price (â‚¹)</th>
        <th>Quantity</th>
        <th>Subtotal (â‚¹)</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of cartItems; let i = index">
        <td>{{ item.name }}</td>
        <td>{{ item.price }}</td>
        <td>
          <button (click)="decreaseQty(item)">-</button>
          {{ item.quantity }}
          <button (click)="increaseQty(item)">+</button>
        </td>
        <td>{{ item.price * item.quantity }}</td>
        <td>
          <button class="remove" (click)="removeItem(i)">âŒ</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Empty Cart Message -->
  <ng-template #emptyCart>
    <p class="empty">ğŸ›ï¸ Your cart is empty.</p>
  </ng-template>

  <!-- Totals -->
  <div class="totals" *ngIf="cartItems.length > 0">
    <p>Subtotal: â‚¹{{ getSubtotal() }}</p>

    <!-- Delivery Date -->
    <label for="deliveryDate">Choose Delivery Date *</label>
    <input
      id="deliveryDate"
      type="date"
      [(ngModel)]="deliveryDate"
      (change)="calculateCharges()"
    />

    <!-- Delivery Distance -->
    <div class="delivery-distance">
      <label for="distance">Enter Delivery Distance (km):</label>
      <input
        id="distance"
        type="number"
        min="1"
        [(ngModel)]="distanceInKm"
        (ngModelChange)="calculateNormalDelivery(distanceInKm)"
      />
    </div>

    <p>ğŸšš Normal Delivery Charge: â‚¹{{ normalDeliveryCharge }}</p>

    <p *ngIf="deliveryCharge > 0">
      âš¡ Urgent Delivery Charge: â‚¹{{ deliveryCharge }}
    </p>

    <p>GST (18%): â‚¹{{ gst }}</p>

    <p>
      <b>Total: â‚¹{{ getTotal() }}</b>
    </p>
  </div>

  <!-- Saved Addresses -->
  <div class="address-section" *ngIf="cartItems.length > 0">
    <h3>ğŸ“ Choose Delivery Address</h3>
    <div *ngFor="let addr of addresses">
      <input
        type="radio"
        name="addressOption"
        [value]="addr.id"
        [(ngModel)]="selectedAddressId"
        (change)="useNewAddress = false"
      />
      <b>{{ addr.name }}</b> ({{ addr.phone }}) <br />
      {{ addr.street }}, {{ addr.city }} - {{ addr.pincode }}
      <span *ngIf="addr.landmark">, {{ addr.landmark }}</span>

      <div class="address-actions">
        <button type="button" (click)="editAddress(addr)">âœï¸ Edit</button>
        <button type="button" (click)="deleteAddress(addr.id)" class="delete">
          ğŸ—‘ï¸ Delete
        </button>
      </div>
      <hr />
    </div>
  </div>

  <!-- Manual Address Form -->
  <div class="address-form" *ngIf="cartItems.length > 0">
    <h3>
      {{ editAddressId ? "âœï¸ Edit Delivery Address" : "â• Add New Address" }}
    </h3>
    <form #addressForm="ngForm">
      <label for="name">Full Name *</label>
      <input
        id="name"
        type="text"
        name="name"
        [(ngModel)]="address.name"
        required
      />

      <label for="phone">Phone Number *</label>
      <input
        id="phone"
        type="text"
        name="phone"
        [(ngModel)]="address.phone"
        required
      />

      <label for="street">Street Address *</label>
      <input
        id="street"
        type="text"
        name="street"
        [(ngModel)]="address.street"
        required
      />

      <label for="city">City *</label>
      <input
        id="city"
        type="text"
        name="city"
        [(ngModel)]="address.city"
        required
      />

      <label for="pincode">Pincode *</label>
      <input
        id="pincode"
        type="text"
        name="pincode"
        [(ngModel)]="address.pincode"
        required
      />

      <label for="landmark">Landmark (optional)</label>
      <input
        id="landmark"
        type="text"
        name="landmark"
        [(ngModel)]="address.landmark"
      />
    </form>

    <!-- Cancel Edit button -->
    <button
      *ngIf="editAddressId"
      type="button"
      (click)="cancelEdit()"
      class="cancel"
    >
      âŒ Cancel Edit
    </button>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons" *ngIf="cartItems.length > 0">
    <button type="button" (click)="saveAddress()">ğŸ’¾ Save Address</button>
    <button type="button" (click)="saveCart()">ğŸ›’ Save Cart</button>
    <button type="button" class="clear" (click)="clearCart()">
      ğŸ—‘ï¸ Clear Cart
    </button>
  </div>

  <!-- Continue to Payment -->
  <button
    class="place-order"
    [disabled]="!isAddressValid() || cartItems.length === 0"
    (click)="continueToPayment()"
  >
    ğŸ’³ Continue to Payment
  </button>
</div>
